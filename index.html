<!doctype html>
<html lang="vi" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lịch Công Tác Tuần</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
        }
        * {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        
        /* Màu nền cho từng ngày trong tuần */
        .day-monday { background-color: #fef3c7; }
        .day-tuesday { background-color: #dbeafe; }
        .day-wednesday { background-color: #dcfce7; }
        .day-thursday { background-color: #fce7f3; }
        .day-friday { background-color: #e0e7ff; }
        .day-saturday { background-color: #fed7aa; }
        .day-sunday { background-color: #fecaca; }
        
        /* Highlight ngày hiện tại */
        .today-row {
            background-color: #fef08a !important;
            font-weight: 700;
            position: relative;
        }
        .today-row::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(180deg, #f59e0b, #d97706);
        }
        
        /* Animation cho header */
        @keyframes pulse-subtle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }
        
        .header-badge {
            animation: pulse-subtle 3s ease-in-out infinite;
        }
        
        /* Table styling */
        .schedule-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .schedule-table th {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .schedule-table td, .schedule-table th {
            border: 2px solid #374151;
        }
        
        /* Responsive text sizes for TV */
        @media (min-width: 1920px) {
            .tv-title { font-size: 3rem; }
            .tv-subtitle { font-size: 1.75rem; }
            .tv-table-header { font-size: 1.5rem; }
            .tv-table-cell { font-size: 1.35rem; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gray-50 text-gray-900">
  <div id="app" class="h-full w-full overflow-auto p-6 lg:p-8"><!-- Edit Mode Toggle Button -->
   <div class="fixed top-4 right-4 z-50"><button id="toggle-edit-mode" class="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105 flex items-center gap-2">
     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
     </svg><span id="edit-btn-text">Sửa Dữ Liệu</span> </button>
   </div><!-- Edit Panel (Hidden by default) -->
   <div id="edit-panel" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden">
    <div class="absolute inset-4 bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col"><!-- Edit Panel Header -->
     <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 flex justify-between items-center">
      <div class="flex items-center gap-3">
       <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
       </svg>
       <h2 class="text-2xl font-bold">QUẢN LÝ LỊCH CÔNG TÁC</h2>
      </div><button id="close-edit-panel" class="hover:bg-purple-800 p-2 rounded-lg transition-all">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div><!-- Edit Panel Content -->
     <div class="flex-1 overflow-auto p-6">
      <div class="max-w-6xl mx-auto"><!-- Add New Button -->
       <div class="mb-6"><button id="add-new-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all flex items-center gap-2">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
         </svg> Thêm Công Tác Mới </button>
       </div><!-- Schedule Items List -->
       <div id="edit-list" class="space-y-4"><!-- Will be populated by JavaScript -->
       </div>
      </div>
     </div><!-- Save Button -->
     <div class="bg-gray-100 p-6 border-t-2 border-gray-300 flex justify-end gap-4"><button id="cancel-edit" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all"> Hủy </button> <button id="save-changes" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all flex items-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
       </svg> Lưu Thay Đổi </button>
     </div>
    </div>
   </div><!-- Header Section -->
   <header class="text-center mb-8">
    <div class="inline-flex items-center gap-3 mb-4">
     <div class="w-16 h-16 lg:w-20 lg:h-20 bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl flex items-center justify-center shadow-lg">
      <svg class="w-10 h-10 lg:w-12 lg:h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
     </div>
     <div class="text-left">
      <p id="org-name" class="text-lg lg:text-xl font-semibold text-blue-700 uppercase tracking-wide">ỦY BAN NHÂN DÂN HUYỆN ABC</p>
      <h1 id="main-title" class="text-3xl lg:text-4xl tv-title font-extrabold text-gray-800">LỊCH CÔNG TÁC TUẦN</h1>
     </div>
    </div><!-- Week Info -->
    <div class="flex flex-wrap justify-center gap-4 mt-6">
     <div class="header-badge bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-full shadow-md"><span class="text-lg lg:text-xl tv-subtitle font-bold" id="week-number">Tuần 01</span>
     </div>
     <div class="bg-white border-2 border-gray-300 px-6 py-3 rounded-full shadow-md"><span class="text-lg lg:text-xl tv-subtitle font-semibold text-gray-700" id="week-range">Từ ngày 01/01/2025 đến 07/01/2025</span>
     </div>
     <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-3 rounded-full shadow-md"><span class="text-lg lg:text-xl tv-subtitle font-bold" id="current-date">Hôm nay: Thứ Hai, 01/01/2025</span>
     </div>
    </div>
   </header><!-- Schedule Table -->
   <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-gray-300">
    <table class="schedule-table w-full">
     <thead>
      <tr class="bg-gradient-to-r from-blue-700 to-blue-800 text-white">
       <th class="tv-table-header text-base lg:text-lg px-4 py-4 font-bold text-center w-[12%]">THỜI GIAN</th>
       <th class="tv-table-header text-base lg:text-lg px-4 py-4 font-bold text-center w-[15%]">NGÀY</th>
       <th class="tv-table-header text-base lg:text-lg px-4 py-4 font-bold text-center w-[35%]">NỘI DUNG CÔNG TÁC</th>
       <th class="tv-table-header text-base lg:text-lg px-4 py-4 font-bold text-center w-[18%]">ĐỊA ĐIỂM</th>
       <th class="tv-table-header text-base lg:text-lg px-4 py-4 font-bold text-center w-[20%]">THÀNH PHẦN THAM GIA</th>
      </tr>
     </thead>
     <tbody id="schedule-body"><!-- Dữ liệu sẽ được render bằng JavaScript -->
     </tbody>
    </table>
   </div><!-- Footer -->
   <footer class="mt-8 text-center">
    <p class="text-gray-500 text-sm lg:text-base"><span class="inline-flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg> Cập nhật lúc: <span id="update-time">--:--</span> </span></p>
   </footer>
  </div>
  <script>
        // =====================================================
        // CẤU HÌNH DỮ LIỆU LỊCH - SỬA TẠI ĐÂY
        // =====================================================
        
        /*
         * Hướng dẫn sửa dữ liệu:
         * 1. Mỗi object trong mảng scheduleData là một công tác
         * 2. Các trường dữ liệu:
         *    - date: Ngày theo định dạng "YYYY-MM-DD" (ví dụ: "2025-01-06")
         *    - startTime: Giờ bắt đầu (ví dụ: "08:00")
         *    - endTime: Giờ kết thúc (ví dụ: "11:30")
         *    - content: Nội dung công tác
         *    - location: Địa điểm
         *    - participants: Thành phần tham gia
         * 3. Thêm/xóa/sửa object để cập nhật lịch
         */
        
        const scheduleData = [
            // ===== THỨ HAI =====
            {
                date: "2025-01-06",
                startTime: "07:30",
                endTime: "08:00",
                content: "Chào cờ đầu tuần",
                location: "Sân cơ quan",
                participants: "Toàn thể cán bộ, công chức"
            },
            {
                date: "2025-01-06",
                startTime: "08:30",
                endTime: "11:30",
                content: "Họp giao ban đầu tuần, tri   n khai công tác tuần",
                location: "Phòng họp số 1",
                participants: "Ban lãnh đạo, Trưởng các phòng ban"
            },
            {
                date: "2025-01-06",
                startTime: "14:00",
                endTime: "17:00",
                content: "Làm việc với Đoàn kiểm tra của Tỉnh về công tác cải cách hành chính",
                location: "Phòng họp số 2",
                participants: "Chủ tịch, Phó Chủ tịch, Văn phòng"
            },
            
            // ===== THỨ BA =====
            {
                date: "2025-01-07",
                startTime: "08:00",
                endTime: "11:30",
                content: "Họp Ban chỉ đạo phòng chống dịch bệnh",
                location: "Hội trường lớn",
                participants: "Thành viên BCĐ, Y tế, Công an"
            },
            {
                date: "2025-01-07",
                startTime: "14:00",
                endTime: "16:30",
                content: "Tiếp công dân định kỳ",
                location: "Phòng tiếp công dân",
                participants: "Chủ tịch UBND, Thanh tra, Tư pháp"
            },
            
            // ===== THỨ TƯ =====
            {
                date: "2025-01-08",
                startTime: "08:00",
                endTime: "11:00",
                content: "Kiểm tra tiến độ xây dựng nông thôn mới tại xã A",
                location: "Xã A",
                participants: "Phó Chủ tịch, Phòng NN&PTNT, Xây dựng"
            },
            {
                date: "2025-01-08",
                startTime: "14:00",
                endTime: "17:00",
                content: "Hội nghị sơ kết công tác năm 2024",
                location: "Hội trường UBND",
                participants: "Toàn thể CBCC, Lãnh đạo các xã/thị trấn"
            },
            
            // ===== THỨ NĂM =====
            {
                date: "2025-01-09",
                startTime: "08:00",
                endTime: "11:30",
                content: "Họp Ban Thường vụ Huyện ủy",
                location: "Phòng họp Huyện ủy",
                participants: "Các đồng chí Ủy viên BTV"
            },
            {
                date: "2025-01-09",
                startTime: "14:00",
                endTime: "16:00",
                content: "Làm việc với Ngân hàng về chính sách tín dụng nông nghiệp",
                location: "Phòng họp số 1",
                participants: "Phó Chủ tịch, Tài chính, NN&PTNT"
            },
            
            // ===== THỨ SÁU =====
            {
                date: "2025-01-10",
                startTime: "08:00",
                endTime: "10:00",
                content: "Họp triển khai kế hoạch Tết Nguyên đán 2025",
                location: "Phòng họp số 2",
                participants: "Ban lãnh đạo, VHTT, Công an, Y tế"
            },
            {
                date: "2025-01-10",
                startTime: "10:30",
                endTime: "11:30",
                content: "Ký kết hợp tác với doanh nghiệp về đào tạo nghề",
                location: "Phòng họp số 1",
                participants: "Chủ tịch, LĐTBXH, Công ty XYZ"
            },
            {
                date: "2025-01-10",
                startTime: "14:00",
                endTime: "17:00",
                content: "Thẩm định hồ sơ đấu thầu dự án đường giao thông",
                location: "Phòng họp số 3",
                participants: "Hội đồng thẩm định, Kinh tế - Hạ tầng"
            },
            
            // ===== THỨ BẢY =====
            {
                date: "2025-01-11",
                startTime: "08:00",
                endTime: "11:00",
                content: "Tham dự Lễ khánh thành trường Tiểu học B",
                location: "Trường Tiểu học B, xã C",
                participants: "Chủ tịch UBND, GD&ĐT, UBND xã C"
            }
        ];
        
        // =====================================================
        // KẾT THÚC PHẦN CẤU HÌNH DỮ LIỆU
        // =====================================================

        // Default configuration
        const defaultConfig = {
            organization_name: "ĐẢNG ỦY XÃ PHÚ TÚC",
            title_text: "LỊCH CÔNG TÁC TUẦN",
            primary_color: "#1d4ed8",
            secondary_color: "#ffffff",
            text_color: "#1f2937",
            accent_color: "#f59e0b",
            header_color: "#1e40af"
        };

        let config = { ...defaultConfig };

        // Utility functions
        function getISOWeek(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function getWeekDates(date) {
            const day = date.getDay();
            const diff = date.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(date);
            monday.setDate(diff);
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            return { monday, sunday };
        }

        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function getDayName(date) {
            const days = ['Chủ Nhật', 'Thứ Hai', 'Thứ Ba', 'Thứ Tư', 'Thứ Năm', 'Thứ Sáu', 'Thứ Bảy'];
            return days[date.getDay()];
        }

        function getDayClass(date) {
            const dayIndex = date.getDay();
            const classes = {
                0: 'day-sunday',
                1: 'day-monday',
                2: 'day-tuesday',
                3: 'day-wednesday',
                4: 'day-thursday',
                5: 'day-friday',
                6: 'day-saturday'
            };
            return classes[dayIndex];
        }

        function isToday(dateString) {
            const today = new Date();
            const compareDate = new Date(dateString);
            return today.toDateString() === compareDate.toDateString();
        }

        function parseDate(dateString) {
            return new Date(dateString + 'T00:00:00');
        }

        // Render schedule
        function renderSchedule() {
            const tbody = document.getElementById('schedule-body');
            const today = new Date();
            const { monday, sunday } = getWeekDates(today);
            const weekNum = getISOWeek(today);

            // Update header info
            document.getElementById('week-number').textContent = `Tuần ${String(weekNum).padStart(2, '0')}`;
            document.getElementById('week-range').textContent = `Từ ngày ${formatDate(monday)} đến ${formatDate(sunday)}`;
            document.getElementById('current-date').textContent = `Hôm nay: ${getDayName(today)}, ${formatDate(today)}`;
            document.getElementById('update-time').textContent = today.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });

            // Sort schedule by date and time
            const sortedSchedule = [...scheduleData].sort((a, b) => {
                const dateCompare = a.date.localeCompare(b.date);
                if (dateCompare !== 0) return dateCompare;
                return a.startTime.localeCompare(b.startTime);
            });

            // Group by date
            const groupedSchedule = {};
            sortedSchedule.forEach(item => {
                if (!groupedSchedule[item.date]) {
                    groupedSchedule[item.date] = [];
                }
                groupedSchedule[item.date].push(item);
            });

            // Generate HTML
            let html = '';
            
            Object.keys(groupedSchedule).sort().forEach(date => {
                const items = groupedSchedule[date];
                const dateObj = parseDate(date);
                const dayClass = getDayClass(dateObj);
                const todayClass = isToday(date) ? 'today-row' : '';
                
                items.forEach((item, index) => {
                    html += `
                        <tr class="${dayClass} ${todayClass} hover:brightness-95 transition-all">
                            <td class="tv-table-cell text-sm lg:text-base px-4 py-4 text-center font-semibold border-gray-400">
                                ${item.startTime} - ${item.endTime}
                            </td>
                            ${index === 0 ? `
                                <td class="tv-table-cell text-sm lg:text-base px-4 py-4 text-center border-gray-400" rowspan="${items.length}">
                                    <div class="font-bold text-blue-800">${getDayName(dateObj)}</div>
                                    <div class="text-gray-600 mt-1">${formatDate(dateObj)}</div>
                                    ${isToday(date) ? '<div class="mt-2"><span class="bg-amber-500 text-white text-xs px-2 py-1 rounded-full font-bold">HÔM NAY</span></div>' : ''}
                                </td>
                            ` : ''}
                            <td class="tv-table-cell text-sm lg:text-base px-4 py-4 border-gray-400">
                                <div class="font-semibold">${item.content}</div>
                            </td>
                            <td class="tv-table-cell text-sm lg:text-base px-4 py-4 text-center border-gray-400">
                                <div class="flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    <span>${item.location}</span>
                                </div>
                            </td>
                            <td class="tv-table-cell text-sm lg:text-base px-4 py-4 border-gray-400">
                                ${item.participants}
                            </td>
                        </tr>
                    `;
                });
            });

            // If no data
            if (html === '') {
                html = `
                    <tr>
                        <td colspan="5" class="text-center py-16 text-gray-500">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <p class="text-xl font-semibold">Chưa có lịch công tác</p>
                            <p class="mt-2">Vui lòng cập nhật dữ liệu trong mảng scheduleData</p>
                        </td>
                    </tr>
                `;
            }

            tbody.innerHTML = html;
        }

        // Apply configuration to UI
        async function onConfigChange(cfg) {
            config = { ...defaultConfig, ...cfg };
            
            document.getElementById('org-name').textContent = config.organization_name || defaultConfig.organization_name;
            document.getElementById('main-title').textContent = config.title_text || defaultConfig.title_text;
            
            renderSchedule();
        }

        // Map to capabilities for color/font editing
        function mapToCapabilities(cfg) {
            return {
                recolorables: [
                    {
                        get: () => cfg.primary_color || defaultConfig.primary_color,
                        set: (value) => {
                            cfg.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    },
                    {
                        get: () => cfg.secondary_color || defaultConfig.secondary_color,
                        set: (value) => {
                            cfg.secondary_color = value;
                            window.elementSdk.setConfig({ secondary_color: value });
                        }
                    },
                    {
                        get: () => cfg.text_color || defaultConfig.text_color,
                        set: (value) => {
                            cfg.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => cfg.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            cfg.accent_color = value;
                            window.elementSdk.setConfig({ accent_color: value });
                        }
                    },
                    {
                        get: () => cfg.header_color || defaultConfig.header_color,
                        set: (value) => {
                            cfg.header_color = value;
                            window.elementSdk.setConfig({ header_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        // Map to edit panel values
        function mapToEditPanelValues(cfg) {
            return new Map([
                ["organization_name", cfg.organization_name || defaultConfig.organization_name],
                ["title_text", cfg.title_text || defaultConfig.title_text]
            ]);
        }

        // Edit mode functionality
        let editableScheduleData = [...scheduleData];
        let isEditMode = false;

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const panel = document.getElementById('edit-panel');
            const btnText = document.getElementById('edit-btn-text');
            
            if (isEditMode) {
                panel.classList.remove('hidden');
                btnText.textContent = 'Đóng';
                renderEditList();
            } else {
                panel.classList.add('hidden');
                btnText.textContent = 'Sửa Dữ Liệu';
            }
        }

        function renderEditList() {
            const editList = document.getElementById('edit-list');
            const sortedData = [...editableScheduleData].sort((a, b) => {
                const dateCompare = a.date.localeCompare(b.date);
                if (dateCompare !== 0) return dateCompare;
                return a.startTime.localeCompare(b.startTime);
            });

            let html = '';
            sortedData.forEach((item, index) => {
                const dateObj = parseDate(item.date);
                html += `
                    <div class="bg-gray-50 border-2 border-gray-300 rounded-xl p-5 hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                                    ${index + 1}
                                </div>
                                <div>
                                    <span class="text-sm text-gray-500">Ngày</span>
                                    <div class="font-bold text-lg text-blue-700">${getDayName(dateObj)}, ${formatDate(dateObj)}</div>
                                </div>
                            </div>
                            <button onclick="deleteScheduleItem(${index})" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-all flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Xóa
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ngày (YYYY-MM-DD)</label>
                                <input type="date" value="${item.date}" onchange="updateScheduleItem(${index}, 'date', this.value)" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Giờ bắt đầu</label>
                                    <input type="time" value="${item.startTime}" onchange="updateScheduleItem(${index}, 'startTime', this.value)" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Giờ kết thúc</label>
                                    <input type="time" value="${item.endTime}" onchange="updateScheduleItem(${index}, 'endTime', this.value)" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Nội dung công tác</label>
                                <textarea value="${item.content}" onchange="updateScheduleItem(${index}, 'content', this.value)" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" rows="2">${item.content}</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Địa điểm</label>
                                <input type="text" value="${item.location}" onchange="updateScheduleItem(${index}, 'location', this.value)" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Thành phần tham gia</label>
                                <input type="text" value="${item.participants}" onchange="updateScheduleItem(${index}, 'participants', this.value)" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>
                `;
            });

            if (html === '') {
                html = `
                    <div class="text-center py-16 text-gray-500">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <p class="text-xl font-semibold">Chưa có lịch công tác</p>
                        <p class="mt-2">Nhấn "Thêm Công Tác Mới" để bắt đầu</p>
                    </div>
                `;
            }

            editList.innerHTML = html;
        }

        function updateScheduleItem(index, field, value) {
            editableScheduleData[index][field] = value;
        }

        function deleteScheduleItem(index) {
            if (confirm('Bạn có chắc muốn xóa công tác này?')) {
                editableScheduleData.splice(index, 1);
                renderEditList();
            }
        }

        function addNewScheduleItem() {
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            
            const newItem = {
                date: dateStr,
                startTime: "08:00",
                endTime: "10:00",
                content: "Nội dung công tác mới",
                location: "Địa điểm",
                participants: "Thành phần tham gia"
            };
            
            editableScheduleData.push(newItem);
            renderEditList();
            
            // Scroll to bottom
            const editList = document.getElementById('edit-list');
            setTimeout(() => {
                editList.scrollTop = editList.scrollHeight;
            }, 100);
        }

        function saveChanges() {
            // Copy edited data back to original
            scheduleData.length = 0;
            scheduleData.push(...editableScheduleData);
            
            // Re-render the schedule
            renderSchedule();
            
            // Close edit panel
            toggleEditMode();
            
            // Show success message
            showNotification('✅ Đã lưu thay đổi thành công!');
        }

        function cancelEdit() {
            // Reset to original data
            editableScheduleData = [...scheduleData];
            toggleEditMode();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-xl z-50 font-bold text-lg animate-bounce';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Event listeners
        document.getElementById('toggle-edit-mode').addEventListener('click', toggleEditMode);
        document.getElementById('close-edit-panel').addEventListener('click', toggleEditMode);
        document.getElementById('add-new-btn').addEventListener('click', addNewScheduleItem);
        document.getElementById('save-changes').addEventListener('click', saveChanges);
        document.getElementById('cancel-edit').addEventListener('click', cancelEdit);

        // Make functions global
        window.updateScheduleItem = updateScheduleItem;
        window.deleteScheduleItem = deleteScheduleItem;

        // Initialize
        async function init() {
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            } else {
                onConfigChange(defaultConfig);
            }
        }

        init();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c04fa5032feb31b',t:'MTc2ODgxMTUwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>
